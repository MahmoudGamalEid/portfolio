!function(){function e(){(document.addEventListener||"load"===event.type||"complete"===document.readyState)&&(t(),window.__cse_page_ready=!0)}function t(){document.addEventListener?(document.removeEventListener("DOMContentLoaded",e,!1),window.removeEventListener("load",e,!1)):(document.detachEvent("onreadystatechange",e),window.detachEvent("onload",e))}return window.__cse_page_ready=!1,document&&"complete"!==document.readyState?(document.addEventListener?(document.addEventListener("DOMContentLoaded",e,!1),window.addEventListener("load",e,!1)):(document.attachEvent("onreadystatechange",e),window.attachEvent("onload",e)),void 0):window.__cse_page_ready=!0}(),function(e){e("cse/core/cse.js",["noder-js/promise","noder-js/asyncRequire","./placeholderStore","./utils","./defaultPlaceholderHandler"],function(e){var t=e.require,n=(e.exports,e.filename,e.dirname,t("noder-js/promise")),r=t("noder-js/asyncRequire"),i=t("./placeholderStore"),a=t("./utils"),o=a.formatMessage,s=a.removeTrailingSlashes,l=null,d={},c=new i,h=t("./defaultPlaceholderHandler"),u=0,f={},p="data-placeholder-path",v=function(e,t){if(!e.path)throw t.MISSING_PATH;if(e.path=s(e.path),!e.name)throw o(t.MISSING_NAME,[e.path]);_(e,t)},_=function(e,t){if(!e.container){if(window.__cse_page_ready)throw o(t.MISSING_CONTAINER,[e.path]);var n="__cse"+u,r=document;r.write('<div id="'+n+'"></div>');var i=e.container=r.getElementById(n);f[e.path]=i,u++}"string"==typeof e.container&&(e.container=document.getElementById(e.container)),e.container.setAttribute(p,e.path)},S=function(e,t){var n=l[e];if(!n)throw o(t.MISSING_CUST_CONFIGURATION,[e]);if("string"==typeof n)return{handler:d.$default,args:n};var r=n.type||"$default";if(!d[r])throw o(t.MISSING_PH_HANDLER,[r]);return{handler:d[r],args:n}},m=function(e,t){if(!c.retrieve(e))throw o(t,[e])},E=function(e){var t=f[e];t&&(t.parentNode.removeChild(t),delete f[e])},g=function(){this.registerPlaceholderHandler(h)},I=g.prototype;I.$dispose=function(){this.unregisterPlaceholderHandler(h),this.deletePlaceholder(""),c.$dispose()},I.ERRORS={MISSING_CONTAINER:"Impossible to create a container for placeholder %1 because the engine is in asynchronous mode",MISSING_PATH:"Missing path in placeholder configuration",MISSING_UPDATE_PATH:"Missing path in update call",MISSING_NAME:"Missing name in placeholder %1 configuration",MISSING_CUST_CONFIGURATION:"Placeholder %1 has no configuration",MISSING_PH_HANDLER:"No placeholder handler for type %1",MISSING_PLACEHOLDER:"Placeholder %1 does not exist",HIDDEN_PARENT:"Cannot show %1. Its parent is hidden",UPDATE_NAME_CHANGE:"Impossible to update placeholder %1: the previous name (%2) is different from the updated one (%3)",UPDATE_TARGET_PATH:"Cannot update placeholder %1 to path %2. The latter already exists"},I.configure=function(e){return"string"!=typeof e?(l=e,n.done):r(e).spreadSync(function(e){l=e})},I.reset=function(){this.deletePlaceholder(""),c.$dispose(),l=null,c=new i},I.createPlaceholder=function(e){e=e||{};try{v(e,this.ERRORS);var t=S(e.name,this.ERRORS)}catch(r){return n.reject(r)}var i=t.handler,a={handler:i,cfg:e,visible:!1};return new n(function(n,r){i.create(t.args,e.args,e.path).thenSync(function(t){a.instance=t;try{c.add(e.path,a)}catch(i){r(i)}n()},r).done()})},I.preload=function(e){for(var t,r=[],i=0,a=e.length;a>i;i++)t=S(e[i],this.ERRORS),r.push(t.handler.preload(t.args));return n.all(r)},I.deletePlaceholder=function(e){m(e,this.ERRORS.MISSING_PLACEHOLDER),c.retrieve(e).value.visible&&this.hide(e),c.remove(e,function(e){""!=e.path&&(e.value.cfg.container.removeAttribute(p),E(e.path),e.value.instance.$dispose&&e.value.instance.$dispose())})},I.show=function(e){var t=this.ERRORS;m(e,t.MISSING_PLACEHOLDER);var n=c.retrieve(e),r=n.value;if(!r.visible){if(!n.parent.value.visible)throw o(t.HIDDEN_PARENT,[e]);r.visible=!0,r.instance.$show(r.cfg.container)}},I.hide=function(e){m(e,this.ERRORS.MISSING_PLACEHOLDER);var t=c.retrieve(e);t.value.visible&&t.traverse(null,function(e){if(""!=e.path){var t=e.value;t.visible&&(t.instance.$hide(t.cfg.container),t.visible=!1)}})},I.update=function(e,t){var n=this.ERRORS;if(!e)throw n.MISSING_UPDATE_PATH;m(e,n.MISSING_PLACEHOLDER),t=t||{},t.path=t.path||e;var r=t.path,i=c.retrieve(e).value,a=i.cfg;if(t.name&&a.name!=t.name)throw o(n.UPDATE_NAME_CHANGE,[r,a.name,t.name]);if(r!=e){if(this.exists(r))throw o(n.UPDATE_TARGET_PATH,[e,r]);c.move(e,r,function(e,t){var n=e.value.cfg;n.path=t,n.container.setAttribute(p,t)})}if(t.args&&a.args!=t.args&&i.instance.$update&&i.instance.$update(t.args),t.container&&(_(t,n),a.container!=t.container)){a.container.removeAttribute(p);var s=i.visible;s&&this.hide(r),a.container=t.container,s&&this.show(r)}},I.exists=function(e){return!!c.retrieve(e)},I.registerPlaceholderHandler=function(e,t){t=t||"$default",d[t]=e},I.unregisterPlaceholderHandler=function(e){e=e||"$default",delete d[e]},I.getCfg=function(){return l},e.exports=new g}),e("cse/core/defaultPlaceholderHandler.js",["noder-js/promise","noder-js/asyncRequire","./utils"],function(e){var t=e.require,n=(e.exports,e.filename,e.dirname,t("noder-js/promise")),r=t("noder-js/asyncRequire"),i=t("./utils"),a=(noder.require("noder-js/currentContext").loader,function(){}),o=a.prototype;o.INVALID_CONFIG='Invalid placeholder configuration: "%1"',o.METHOD_DOES_NOT_EXIST='Method "%1" is not exported by module "%2"',o.create=function(e,t,n){var r=this;return this.preload(e).spreadSync(function(e,a,o){if(!e[a])throw i.formatMessage(r.METHOD_DOES_NOT_EXIST,[a,o]);return e[a](t,n)})},o.preload=function(e){var t=e.match(/^([^:]+)::([^:]+)$/);return null==t?n.reject(i.formatMessage(this.INVALID_CONFIG,[e])):r(t[1]).spreadSync(function(e){return[e,t[2],t[1]]})},e.exports=new a}),e("cse/core/placeholderStore.js",["noder-js/promise","./utils"],function(e){var t=e.require,n=(e.exports,e.filename,e.dirname,t("noder-js/promise"),t("./utils")),r=n.removeTrailingSlashes,i=[].indexOf?function(e,t){return e.indexOf(t)}:function(e,t){for(var n=0,r=e.length;r>n;n++)if(e[n]===t)return n;return-1},a=function(e,t,n){this.value=t,this.path=e||"",this.children=[],this.parent=null,this.onDispose=n},o=a.prototype;o.$dispose=function(e,t){if(t){{this.path}this.onDispose(this),this.value=null,this.path=null,this.children=null,this.parent=null,this.onDispose=null}else this.parent&&this.parent.removeChild(this),this.traverse(null,function(t){e&&e(t),t.$dispose(e,!0)})},o.addChild=function(e){this.children.push(e),e.parent=this},o.removeChild=function(e){var t=this.children,n=i(t,e);return n>-1?t.splice(n,1):null},o.traverse=function(e,t){e&&e(this);for(var n=this.children,r=0,i=n.length;i>r;r++)n[r].traverse(e,t);t&&t(this)};var s=function(){var e=this;this._tree=new a("",{visible:!0},function(){delete e._flat[""],e=null}),this._flat={"":this._tree}},l=s.prototype;l.$dispose=function(){this.remove("")},l.ALREADY_EXISTS="Placeholder %1 already exists",l.MISSING_PARENT="Missing parent for placeholder %1",l.add=function(e,t){var e=r(e);if(this._flat[e])throw n.formatMessage(this.ALREADY_EXISTS,[e]);var i=this._tree;if(this.isRoot(e)||(i=this.getParent(e)),!i)throw n.formatMessage(this.MISSING_PARENT,[e]);var o=this,s=new a(e,t,function(e){delete o._flat[e.path],o=null});return i.addChild(s),this._flat[e]=s,s},l.remove=function(e,t){var n=this.retrieve(e);n&&n.$dispose(t)},l.move=function(e,t,n){var r=this.retrieve(e),i=this;r.traverse(function(r){var a=r.path.replace(e,t),o=i.add(a,r.value);n&&n(o,a)}),this.remove(e)},l.isRoot=function(e){return r(e).split("/").length<2},l.getParent=function(e){return this._flat[n.getParentPath(e)]||null},l.retrieve=function(e){var e=r(e);return this._flat[e]||null},e.exports=s}),e("cse/core/utils.js",[],function(e){var t=(e.require,e.exports,e.filename,e.dirname,function(e,t){t=t||[];for(var n=1,r=t.length;r>=n;n++)e=e.replace(new RegExp("%"+n,"g"),t[n-1]);return e}),n=function(e){return e.replace(/^\//,"").replace(/\/$/,"")},r=function(e){var t=n(e).split("/");return t.pop(),t.join("/")};e.exports={formatMessage:t,removeTrailingSlashes:n,getParentPath:r}})}(noder.define);