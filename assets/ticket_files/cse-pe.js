!function(e){e("cse/utils/$atlasLoader.js",["noder-js/promise"],function(e){var t=e.require,a=e.exports,i=(e.filename,e.dirname,t("noder-js/promise")),n=function(e){return new i(function(t,a){Aria.load({classes:[e],oncomplete:{fn:function(){t()}},onerror:{fn:function(){a(new Error("failed to preload classpath "+e))}}})})},s=a.loadClass=function(e){return Aria.getClassRef(e)};s.$preload=n}),e("cse/pageEngine/CseWidgets.js",["ariatemplates/Aria","ariatemplates/widgetLibs/WidgetLib"],function(e){var t=e.require,a=(e.exports,e.filename,e.dirname,t("ariatemplates/Aria")),i=t("ariatemplates/widgetLibs/WidgetLib");e.exports=a.classDefinition({$classpath:"cse.pageEngine.CseWidgets",$singleton:!0,$extends:i,$prototype:{widgets:{Placeholder:"cse.pageEngine.CustomPlaceholder"}}})}),e("cse/pageEngine/CustomPageConfigHelper.js",["ariatemplates/Aria","ariatemplates/pageEngine/utils/PageConfigHelper","ariatemplates/utils/Array"],function(e){var t=e.require,a=(e.exports,e.filename,e.dirname,t("ariatemplates/Aria")),i=t("ariatemplates/pageEngine/utils/PageConfigHelper"),n=t("ariatemplates/utils/Array");e.exports=a.classDefinition({$classpath:"cse.pageEngine.CustomPageConfigHelper",$extends:i,$prototype:{getPageDependencies:function(){var e=this.$PageConfigHelper.getPageDependencies.apply(this,arguments),t=e.templates,a=this._pageConfig.pageComposition.template,i=n.indexOf(t,a);return i>-1&&t.splice(i,1),e}}})}),e("cse/pageEngine/CustomPageEngine.js",["ariatemplates/Aria","ariatemplates/pageEngine/PageEngine","./PlaceholderHandler","cse/core/cse","noder-js/promise","ariatemplates/utils/Type","./PlaceholderRegistry","ariatemplates/utils/Json","./CustomPageConfigHelper","ariatemplates/pageEngine/utils/PageEngineUtils","noder-js/asyncRequire","./CustomPlaceholder","./utils/CustomSiteConfigHelper","ariatemplates/templates/ModuleCtrlFactory"],function(e){var t=e.require,a=(e.exports,e.filename,e.dirname,t("ariatemplates/Aria")),i=t("ariatemplates/pageEngine/PageEngine"),n=t("./PlaceholderHandler"),s=t("cse/core/cse"),r=t("noder-js/promise"),o=t("ariatemplates/utils/Type"),l=t("./PlaceholderRegistry"),c=l.customNames,g=t("ariatemplates/utils/Json"),p=t("./CustomPageConfigHelper"),u=t("ariatemplates/pageEngine/utils/PageEngineUtils"),d=t("noder-js/asyncRequire"),h=t("./CustomPlaceholder"),m=t("./utils/CustomSiteConfigHelper"),f=t("ariatemplates/templates/ModuleCtrlFactory"),C=0,P="pageEngine_";e.exports=a.classDefinition({$classpath:"cse.pageEngine.CustomPageEngine",$extends:i,$statics:{HANDLER_TYPE:"$default",FORBIDDEN_MULTIPLE_PLACEHOLDER:"Placeholder %1 in page %2 is an array. This is not allowed in this version of the page engine"},$constructor:function(){this.$PageEngine.$constructor.apply(this,arguments),this._navigationClassPath=null,this._toPreload=[],this._visitedPages=[]},$destructor:function(){for(var e=this._visitedPages,t=0,a=e.length;a>t;t++)s.exists(e[t])&&s.deletePlaceholder(e[t]);this.$PageEngine.$destructor.apply(this,arguments)},$prototype:{start:function(e){s.registerPlaceholderHandler(n,this.HANDLER_TYPE);var t,a=this;this.navigationClassPath=e.navigationClassPath,t="string"==typeof e.customCfg?d(e.customCfg).spreadSync(function(t){e.customCfg=t},function(){e.customCfg={}}):r.done,t.thenSync(function(){s.configure(e.customCfg).thenSync(function(){a.$PageEngine.start.call(a,e)})})},_createModuleCtrl:function(e){this._siteConfigHelper=new m(this._siteConfigHelper.siteConfig,{navigationClassPath:this.navigationClassPath}),f.createModuleCtrl(e,{fn:this.$PageEngine._loadSiteDependencies,scope:this})},_getPageDependencies:function(e,t){var a=this.isConfigValid(e,"aria.pageEngine.CfgBeans.PageDefinition",this.INVALID_PAGE_DEFINITION);if(!a)return this.$callback(t.cb),void 0;var i=e.pageId;this._connectPlaceholderToCse({template:e.pageComposition.template,customName:i},i);var n=e.pageComposition.placeholders;for(var s in n)n.hasOwnProperty(s)&&this._connectPlaceholderToCse(n[s],i+"."+s);var r=this._getPageConfigHelper(e);g.inject(r.getMenus(),this._siteConfigHelper.getAppData().menus),this._pageConfigHelper=r,this._lazyContent=!0,this._loadPageDependencies({lazy:!1,pageId:e.pageId,cb:{fn:this._displayPage,scope:this,args:{cb:t.cb,pageConfig:e,pageRequest:t.pageRequest}}})},_getPageConfigHelper:function(e){return new p(e)},_loadPageDependencies:function(e){if(!this._pageConfigHelper)return this.$callback(e.cb),void 0;var t=this;this._preloadCustomizedPlaceholders().thenSync(function(){t.$PageEngine._loadPageDependencies.call(t,e)}).catchSync(function(e){t._errorCallback([e])})},_displayPage:function(e){if(!this._pageConfigHelper)return this.$callback(e.cb),void 0;var t=e.pageConfig,a=t.pageComposition,i=t.pageId;this.$raiseEvent({name:"beforePageTransition",from:this.currentPageId,to:i}),this._previousPageId=this.currentPageId,this.currentPageId=i,this._pageConfigs[i]=t;var n=e.pageRequest;t.pageData=t.pageComposition.pageData;var r=window.__gateway?window.__gateway.router:null,o=r?r.state({}):{};n.state={data:{pageDefinitionConfig:t,siteConfiguration:this._config.pageProvider._siteConfiguration},index:o.index,sessionId:window.sessionId},n.url=t.url,n.pageId=t.pageId,n.title=t.title,this._data.pageData=a.pageData,this._data.pageInfo=n;var c=this._getContainer(!t.animation);this._modulesInPage=[],c==this._getContainer()&&this._isTemplateLoaded&&s.hide(this._previousPageId);var g=this,p=function(){s.show(i),g._afterTemplateLoaded.call(g,!0,{pageConfig:t,cb:e.cb,div:c,pageRequest:n})};l.placeholdersOnPage=[],s.exists(i)?(s.update(i,{container:c}),p()):(u.addIfMissing(i,this._visitedPages),s.createPlaceholder({path:i,name:i,container:c}).thenSync(p,function(e){g._errorCallback([e])}))},_pageTransitionComplete:function(e,t){this._animationsManager.$removeListeners({animationend:this._pageTransitionComplete,scope:this}),this._activeDiv=(this._activeDiv+1)%2,this._previousPageId&&s.hide(this._previousPageId),this._finishDisplay(t)},getContent:function(e){if(e==this.currentPageId)return{moduleCtrl:this._rootModule};e=h.getOriginalPath(e.replace(/^[^\.]+\./,""));var t=this._pageConfigs[this.currentPageId];if(t){var a=t.pageComposition.placeholders,i=a[e]||{};if(o.isArray(i))return this._errorCallback([this.FORBIDDEN_MULTIPLE_PLACEHOLDER,[e,this.currentPageId]]),void 0;var n={};i.contentId&&(n.content=this._getPlaceholderContents(t,i.contentId));var s=this._findModuleInHierarchy(e).value;return s&&(n.moduleCtrl=s,this._modulesInPage.push(s)),i.args&&(n.args=i.args),n.customModules=this._retrieveCustomModules(i.customModules,e),n}},_retrieveCustomModules:function(e,t){var a,i={};if(null==e)return a=this._findModuleInHierarchy(t),i[a.key]=a.value,i;for(var n=0,s=e.length;s>n;n++)a=e[n],i[a]="rootModule"==a?this._rootModule:this._rootModule.getPageModule(this.currentPageId,a);return i},_findModuleInHierarchy:function(e){if(!e)return{key:"rootModule",value:this._rootModule};var t=this._pageConfigs[this.currentPageId];if(t){var a=t.pageComposition.placeholders,i=a[e]||{};return i.module?{key:i.module,value:this._rootModule.getPageModule(this.currentPageId,i.module)}:this._findModuleInHierarchy(e.replace(/^[^\.]+$/,"").replace(/\.[^\.]+$/,""))}return null},_connectPlaceholderToCse:function(e,t){var a=s.getCfg()||{},i=e.customName||c[t];i||(i=P+C,C++,e.customName=i),a[i]?delete e.template:a[i]={type:this.HANDLER_TYPE,template:e.template||null,content:o.isString(e)?e:null,contentId:e.contentId||null},this._toPreload.push(i),c[t]=i,s.configure(a)},_preloadCustomizedPlaceholders:function(){var e=this._toPreload;return new r(function(t,a){s.preload(e).thenSync(function(){e.splice(0,e.length),t()},a)})}}})}),e("cse/pageEngine/CustomPlaceholder.js",["ariatemplates/Aria","ariatemplates/widgetLibs/BaseWidget","./PlaceholderRegistry","ariatemplates/utils/Dom","cse/core/cse","ariatemplates/utils/Array"],function(e){var t=e.require,a=(e.exports,e.filename,e.dirname,t("ariatemplates/Aria")),i=t("ariatemplates/widgetLibs/BaseWidget"),n=t("./PlaceholderRegistry"),s=n.customNames,r=t("ariatemplates/utils/Dom"),o=t("cse/core/cse"),l=t("ariatemplates/utils/Array");e.exports=a.classDefinition({$classpath:"cse.pageEngine.CustomPlaceholder",$extends:i,$destructor:function(){o.exists(this._csePath)&&o.deletePlaceholder(this._csePath);var e=n.placeholdersOnPage;l.remove(e,this._csePath),this.$BaseWidget.$destructor.call(this)},$statics:{SUFFIX_FOR_MULTIPLE:"__$",getOriginalPath:function(e){return e.replace(/__\$\d+/g,"")}},$prototype:{writeMarkup:function(e){this._domId=this._createDynamicId();var t=this._cfg.type||"span",a=["<",t,' id="',this._domId,'"'];this._cfg.attributes&&a.push(" "+aria.utils.Html.buildAttributeList(this._cfg.attributes)),a.push("><div></div></"+t+">"),e.write(a.join(""))},initWidget:function(){var e=this._cfg,t=this._getPlaceholderPath(e.name),a=this._getFirstAvailable(t.replace(/\./g,"/"));this._csePath=a;var i=s[this.getOriginalPath(t)]||e.customName;if(i){var n={container:r.getElementById(this._domId).firstChild,path:a,name:i};o.exists(a)?(o.update(a,n),o.show(a)):o.createPlaceholder(n).thenSync(function(){o.show(a)}).done()}},_getPlaceholderPath:function(){return this._context.placeholderPath+"."+this._cfg.name},_getFirstAvailable:function(e){var t=this.SUFFIX_FOR_MULTIPLE,a=n.placeholdersOnPage;if(!l.contains(a,e))return a.push(e),e;for(var i=1,s=e+t+i;l.contains(a,s);)i++,s=e+t+i;return a.push(s),s}}})}),e("cse/pageEngine/PlaceholderHandler.js",["noder-js/promise","ariatemplates/utils/Type","ariatemplates/embed/PlaceholderManager","ariatemplates/templates/TemplateCtxt","cse/core/defaultPlaceholderHandler","ariatemplates/utils/ScriptLoader","ariatemplates/utils/CSSLoader"],function(e){var t=e.require,a=(e.exports,e.filename,e.dirname,t("noder-js/promise")),i=t("ariatemplates/utils/Type"),n=t("ariatemplates/embed/PlaceholderManager"),s=t("ariatemplates/templates/TemplateCtxt"),r=t("cse/core/defaultPlaceholderHandler"),o=t("ariatemplates/utils/ScriptLoader"),l=t("ariatemplates/utils/CSSLoader"),c=function(){var e=aria.core.AppEnvironment.applicationSettings.defaultWidgetLibs||{};e.embed="cse.pageEngine.CseWidgets",e.aria="aria.widgets.AriaLib",aria.core.AppEnvironment.setEnvironment({defaultWidgetLibs:e})},g=c.prototype,p=function(e){return"string"==typeof e||e.module},u=function(e){throw e},d=function(e){return"string"!=typeof e?(e.css&&l.add(e.css),r.preload(e.module).thenSync(function(){return e.scripts?new a(function(t){o.load(h(e.scripts),function(){t()})}):void 0},u)):r.preload(e).catchSync(u)},h=function(e){for(var t=[],a=0,i=e.length;i>a;a++)t.push(aria.core.DownloadMgr.resolveURL(e[a]));return t},m=function(e,t){var a=e.content||t.content,i=t.args||[];return a&&i.push(a),i};g.create=function(e,t,a){var i=this;return this.preload(e).thenSync(function(){return i._makeInstance(e,t,a).catchSync(u)},u)},g.preload=function(e){return p(e)?d(e):new a(function(t){e.template?Aria.load({templates:[e.template],oncomplete:function(){t()}}):t()})},g._makeInstance=function(e,t,s){var o=n.getContent(s.replace(/[\/\\]/g,"."));if(o=i.isArray(o)&&o.length>0?o[0]:{},p(e)){var l={args:m(e,o)},c=o.customModules;for(var g in c)c.hasOwnProperty(g)&&(l[g]=c[g]);return r.create("string"==typeof e?e:e.module,l,s)}var u=this;return new a(function(a){e.content&&!e.template&&a(u._makeInstanceForStringContent(e.content)),e.template&&a(u._makeTemplateBasedInstance(e,t,o,s)),a(u._makeInstanceForStringContent(o.content)),u=null})},g._makeInstanceForStringContent=function(e){return e=i.isArray(e)?e.join(""):e,{$show:function(t){t.innerHTML=e},$hide:function(e){e.innerHTML=""}}},g._makeTemplateBasedInstance=function(e,t,a,i){var n={classpath:e.template,moduleCtrl:a.moduleCtrl};n.args=m(e,a);var r;return{$show:function(e){n.tplDiv=e,r=new s,r.placeholderPath=i.replace(/[\\\/]/g,"."),r.initTemplate(n),r._tpl.customModules=a.customModules,r.dataReady(),e.className=e.className+" "+r.getCSSClassNames(!0),r.$refresh(),r.viewReady(),r._cfg.div=e},$hide:function(e){e.removeAttribute("_template"),e.removeAttribute("atdelegate"),e.className=e.className.replace(" "+r.getCSSClassNames(!0),""),r.$dispose()},$dispose:function(){n=null}}},e.exports=new c}),e("cse/pageEngine/PlaceholderRegistry.js",[],function(e){var t=(e.require,e.exports,e.filename,e.dirname,{customNames:{},placeholdersOnPage:[]});e.exports=t}),e("cse/pageEngine/utils",[],function(e){e.require,e.exports,e.filename,e.dirname}),e("cse/pageEngine/utils/CustomSiteConfigHelper.js",["ariatemplates/Aria","ariatemplates/pageEngine/utils/SiteConfigHelper"],function(e){var t=e.require,a=(e.exports,e.filename,e.dirname,t("ariatemplates/Aria")),i=t("ariatemplates/pageEngine/utils/SiteConfigHelper");e.exports=a.classDefinition({$classpath:"cse.pageEngine.utils.CustomSiteConfigHelper",$extends:i,$constructor:function(e,t){this.$SiteConfigHelper.$constructor.call(this,e),this.optionalConfig=t||{}},$prototype:{getNavigationManagerClass:function(){return this.optionalConfig.navigationClassPath&&""!==this.optionalConfig.navigationClassPath?this.optionalConfig.navigationClassPath:this.$SiteConfigHelper.getNavigationManagerClass.call(this)},getNavigationManager:function(e,t){var i=this.getNavigationManagerClass(),n=a.getClassRef(i);if(!n)throw new Error("No navigation manager has been found: "+i+". Please check if it was loaded");return new n(e,t)}}})})}(noder.define);